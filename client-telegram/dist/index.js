import {Telegraf}from'telegraf';import {message}from'telegraf/filters';export{code,fmt}from'telegraf/format';var a=class{static metadata={identifier:"client-telegram",description:"Basic Telegram client through Telegraf.",key:"telegram"};config={};secrets={};client;threads=[];messages=[];_puppet;_context;constructor(e,s,t,i){this._context=i,this._puppet=t,this.config={...this.config,...e},this.secrets={...this.secrets,...s};try{this.client=new Telegraf(this.secrets.botToken||"UNDEFINED");}catch{this._context.utils.logger.send({type:"ERROR",origin:{type:"PUPPET",id:this._puppet.id},data:{message:"Could not connect to Telegram bot"}});}this._init();}_init=async()=>{this.client?.on(message("text"),e=>{this._storeMessage(e);}),this.client?.launch(),process.once("SIGINT",()=>this.client?.stop("SIGINT")),process.once("SIGTERM",()=>this.client?.stop("SIGTERM"));};_storeMessage=async e=>{let s={id:e.message.message_id,text:e.message.text,is_read:false,from:{id:e.message.from.id,name:e.message.from.first_name},metadata:{chat:{type:e.message.chat.type},replyFn:async t=>{await e.reply(t,{reply_to_message_id:e.message.message_id});}}};return this.messages.push(s),s};getMessageThreads=()=>this.threads;addMessageThread=e=>{this.threads.push(e);};getMessages=()=>this.messages.filter(e=>!e.is_read);clearReadMessages=()=>{this.messages=this.messages.filter(e=>!e.is_read);};sendMessage=async(e,s)=>{await this.client?.telegram.sendMessage(s,e);};replyToMessage=async(e,s)=>{await s(e);};markAsRead=async e=>{let s=this.messages.find(t=>t.id===e);s&&(s.is_read=true);}},p=a;export{p as default};